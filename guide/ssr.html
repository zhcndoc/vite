<!DOCTYPE html>
<html lang="zh-CN" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>服务端渲染 (SSR) - Vite 中文文档</title>
    <meta name="description" content="下一代前端工具链">
    <meta name="generator" content="VitePress v2.0.0-alpha.7">
    <link rel="preload stylesheet" href="/assets/style.DnfaGY_p.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.CtulUYnq.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/theme.D4doTNcH.js">
    <link rel="modulepreload" href="/assets/chunks/framework.CYFbgU53.js">
    <link rel="modulepreload" href="/assets/guide_ssr.md.D03Fe-Ga.lean.js">
    <link rel="icon" type="image/svg+xml" href="/logo.svg">
    <link rel="alternate" type="application/rss+xml" href="/blog.rss">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="true">
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;family=Manrope:wght@600&amp;family=IBM+Plex+Mono:wght@400&amp;display=swap" as="style">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&amp;family=Manrope:wght@600&amp;family=IBM+Plex+Mono:wght@400&amp;display=swap">
    <script>(()=>{const n=(s,t,_=!1)=>{const e=localStorage.getItem(s);(e?e!=="false":_)&&document.documentElement.classList.add(t)};window.__VITE_BANNER_ID__="viteplusannouncement",n(`vite-docs-banner-${__VITE_BANNER_ID__}`,"banner-dismissed")})();</script>
    <link rel="me" href="https://m.webtoo.ls/@vite">
    <meta property="og:type" content="website">
    <meta property="og:title" content="服务端渲染 (SSR)">
    <meta property="og:image" content="https://vite.zhcndoc.com/og-image.jpg">
    <meta property="og:url" content="https://vite.zhcndoc.com">
    <meta property="og:description" content="Next Generation Frontend Tooling">
    <meta property="og:site_name" content="vitejs">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@vite_js">
    <meta name="theme-color" content="#646cff">
    <script src="https://www.zhcndoc.com/js/common.js" async></script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
    <link rel="canonical" href="https://vite.zhcndoc.com/guide/ssr">
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-f1c65288><!--[--><!--]--><!--[--><span tabindex="-1" data-v-6fe7cbee></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-6fe7cbee>Skip to content</a><!--]--><!----><header class="VPNav" data-v-f1c65288 data-v-c547271b><div class="VPNavBar" data-v-c547271b data-v-9a3a7d9c><div class="wrapper" data-v-9a3a7d9c><div class="container" data-v-9a3a7d9c><div class="title" data-v-9a3a7d9c><div class="VPNavBarTitle has-sidebar" data-v-9a3a7d9c data-v-cf4a9d3a><a class="title" href="/" data-v-cf4a9d3a><!--[--><!--]--><!--[--><img class="VPImage logo" src="/logo.svg" alt data-v-ba1c87f7><!--]--><span data-v-cf4a9d3a>Vite 中文文档</span><!--[--><!--]--></a></div></div><div class="content" data-v-9a3a7d9c><div class="content-body" data-v-9a3a7d9c><!--[--><!--]--><div class="VPNavBarSearch search" data-v-9a3a7d9c><!--[--><!----><div id="local-search"><button type="button" class="DocSearch DocSearch-Button" aria-label="搜索"><span class="DocSearch-Button-Container"><span class="vp-icon DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">搜索</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key">K</kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-9a3a7d9c data-v-f891e358><span id="main-nav-aria-label" class="visually-hidden" data-v-f891e358> Main Navigation </span><!--[--><!--[--><!----><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink active" href="/guide/" tabindex="0" data-v-f891e358 data-v-6d43398b><!--[--><span data-v-6d43398b>指引</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/config/" tabindex="0" data-v-f891e358 data-v-6d43398b><!--[--><span data-v-6d43398b>配置</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/plugins/" tabindex="0" data-v-f891e358 data-v-6d43398b><!--[--><span data-v-6d43398b>插件</span><!--]--></a><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f891e358 data-v-fd72bfee><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-fd72bfee><span class="text" data-v-fd72bfee><!----><span data-v-fd72bfee>相关链接</span><span class="vpi-chevron-down text-icon" data-v-fd72bfee></span></span></button><div class="menu" data-v-fd72bfee><div class="VPMenu" data-v-fd72bfee data-v-68d0c963><div class="items" data-v-68d0c963><!--[--><!--[--><div class="VPMenuLink" data-v-68d0c963 data-v-919a3c81><a class="VPLink link" href="/team.html" data-v-919a3c81><!--[--><span data-v-919a3c81>团队成员</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-68d0c963 data-v-919a3c81><a class="VPLink link" href="/blog.html" data-v-919a3c81><!--[--><span data-v-919a3c81>最新博客</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-68d0c963 data-v-919a3c81><a class="VPLink link" href="/releases.html" data-v-919a3c81><!--[--><span data-v-919a3c81>发布策略</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-68d0c963 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://www.youtube.com/watch?v=bmWQqAKLgT4" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>纪录片</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuGroup" data-v-68d0c963 data-v-09ae761a><!----><!--[--><!--[--><div class="VPMenuLink" data-v-09ae761a data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://bsky.app/profile/vite.dev" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Bluesky</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-09ae761a data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://elk.zone/m.webtoo.ls/@vite" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Mastodon</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-09ae761a data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://x.com/vite_js" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>X</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-09ae761a data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://chat.vite.dev" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Discord 聊天室</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-09ae761a data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://github.com/vitejs/awesome-vite" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Awesome Vite</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-09ae761a data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://viteconf.org" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>ViteConf</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-09ae761a data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://dev.to/t/vite" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Dev.to 社区</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-09ae761a data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://github.com/vitejs/vite/blob/main/packages/vite/CHANGELOG.md" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>更新日志</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-09ae761a data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://github.com/vitejs/vite/blob/main/CONTRIBUTING.md" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>贡献指南</span><!--]--></a></div><!--]--><!--]--></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--[--><div class="VPFlyout VPNavBarMenuGroup" data-v-f891e358 data-v-fd72bfee><button type="button" class="button" aria-haspopup="true" aria-expanded="false" data-v-fd72bfee><span class="text" data-v-fd72bfee><!----><span data-v-fd72bfee>历史版本</span><span class="vpi-chevron-down text-icon" data-v-fd72bfee></span></span></button><div class="menu" data-v-fd72bfee><div class="VPMenu" data-v-fd72bfee data-v-68d0c963><div class="items" data-v-68d0c963><!--[--><!--[--><div class="VPMenuLink" data-v-68d0c963 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://v6.vite.dev" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Vite v6 文档（英文）</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-68d0c963 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://v5.vite.dev" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Vite v5 文档（英文）</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-68d0c963 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://v4.vite.dev" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Vite v4 文档（英文）</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-68d0c963 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://v3.vite.dev" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Vite v3 文档（英文）</span><!--]--></a></div><!--]--><!--[--><div class="VPMenuLink" data-v-68d0c963 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://v2.vite.dev" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Vite v2 文档（英文）</span><!--]--></a></div><!--]--><!--]--></div><!--[--><!--]--></div></div></div><!--]--><!--]--></nav><div class="VPFlyout VPNavBarTranslations translations" data-v-9a3a7d9c data-v-61668abb data-v-fd72bfee><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="Change language" data-v-fd72bfee><span class="text" data-v-fd72bfee><span class="vpi-languages option-icon" data-v-fd72bfee></span><!----><span class="vpi-chevron-down text-icon" data-v-fd72bfee></span></span></button><div class="menu" data-v-fd72bfee><div class="VPMenu" data-v-fd72bfee data-v-68d0c963><!----><!--[--><!--[--><div class="items" data-v-61668abb><p class="title" data-v-61668abb>简体中文</p><!--[--><div class="VPMenuLink" data-v-61668abb data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>English</span><!--]--></a></div><div class="VPMenuLink" data-v-61668abb data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://ja.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>日本語</span><!--]--></a></div><div class="VPMenuLink" data-v-61668abb data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://es.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Español</span><!--]--></a></div><div class="VPMenuLink" data-v-61668abb data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://pt.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Português</span><!--]--></a></div><div class="VPMenuLink" data-v-61668abb data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://ko.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>한국어</span><!--]--></a></div><div class="VPMenuLink" data-v-61668abb data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://de.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Deutsch</span><!--]--></a></div><div class="VPMenuLink" data-v-61668abb data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://fa.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>فارسی</span><!--]--></a></div><!--]--></div><!--]--><!--]--></div></div></div><div class="VPNavBarAppearance appearance" data-v-9a3a7d9c data-v-a90530ed><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-a90530ed data-v-5a93df26 data-v-295a837a><span class="check" data-v-295a837a><span class="icon" data-v-295a837a><!--[--><span class="vpi-sun sun" data-v-5a93df26></span><span class="vpi-moon moon" data-v-5a93df26></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-9a3a7d9c data-v-5d6c9033 data-v-336bfc3d><!--[--><a class="VPSocialLink no-icon" href="https://bsky.app/profile/vite.dev" aria-label="bluesky" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-bluesky"></span></a><a class="VPSocialLink no-icon" href="https://elk.zone/m.webtoo.ls/@vite" aria-label="mastodon" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-mastodon"></span></a><a class="VPSocialLink no-icon" href="https://x.com/vite_js" aria-label="x" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-x"></span></a><a class="VPSocialLink no-icon" href="https://chat.vite.dev" aria-label="discord" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-discord"></span></a><a class="VPSocialLink no-icon" href="https://github.com/vitejs/vite" aria-label="github" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-9a3a7d9c data-v-04f138a5 data-v-fd72bfee><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-fd72bfee><span class="vpi-more-horizontal icon" data-v-fd72bfee></span></button><div class="menu" data-v-fd72bfee><div class="VPMenu" data-v-fd72bfee data-v-68d0c963><!----><!--[--><!--[--><div class="group translations" data-v-04f138a5><p class="trans-title" data-v-04f138a5>简体中文</p><!--[--><div class="VPMenuLink" data-v-04f138a5 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>English</span><!--]--></a></div><div class="VPMenuLink" data-v-04f138a5 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://ja.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>日本語</span><!--]--></a></div><div class="VPMenuLink" data-v-04f138a5 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://es.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Español</span><!--]--></a></div><div class="VPMenuLink" data-v-04f138a5 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://pt.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Português</span><!--]--></a></div><div class="VPMenuLink" data-v-04f138a5 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://ko.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>한국어</span><!--]--></a></div><div class="VPMenuLink" data-v-04f138a5 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://de.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>Deutsch</span><!--]--></a></div><div class="VPMenuLink" data-v-04f138a5 data-v-919a3c81><a class="VPLink link vp-external-link-icon" href="https://fa.vite.dev/guide/ssr.html" target="_blank" rel="noreferrer" data-v-919a3c81><!--[--><span data-v-919a3c81>فارسی</span><!--]--></a></div><!--]--></div><div class="group" data-v-04f138a5><div class="item appearance" data-v-04f138a5><p class="label" data-v-04f138a5>Appearance</p><div class="appearance-action" data-v-04f138a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-04f138a5 data-v-5a93df26 data-v-295a837a><span class="check" data-v-295a837a><span class="icon" data-v-295a837a><!--[--><span class="vpi-sun sun" data-v-5a93df26></span><span class="vpi-moon moon" data-v-5a93df26></span><!--]--></span></span></button></div></div></div><div class="group" data-v-04f138a5><div class="item social-links" data-v-04f138a5><div class="VPSocialLinks social-links-list" data-v-04f138a5 data-v-336bfc3d><!--[--><a class="VPSocialLink no-icon" href="https://bsky.app/profile/vite.dev" aria-label="bluesky" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-bluesky"></span></a><a class="VPSocialLink no-icon" href="https://elk.zone/m.webtoo.ls/@vite" aria-label="mastodon" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-mastodon"></span></a><a class="VPSocialLink no-icon" href="https://x.com/vite_js" aria-label="x" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-x"></span></a><a class="VPSocialLink no-icon" href="https://chat.vite.dev" aria-label="discord" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-discord"></span></a><a class="VPSocialLink no-icon" href="https://github.com/vitejs/vite" aria-label="github" target="_blank" rel="noopener" data-v-336bfc3d data-v-59172608><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-9a3a7d9c data-v-b86a7766><span class="container" data-v-b86a7766><span class="top" data-v-b86a7766></span><span class="middle" data-v-b86a7766></span><span class="bottom" data-v-b86a7766></span></span></button></div></div></div></div><div class="divider" data-v-9a3a7d9c><div class="divider-line" data-v-9a3a7d9c></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-f1c65288 data-v-9392f0b5><div class="container" data-v-9392f0b5><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-9392f0b5><span class="vpi-align-left menu-icon" data-v-9392f0b5></span><span class="menu-text" data-v-9392f0b5>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-9392f0b5 data-v-d7dcb12b><button data-v-d7dcb12b>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-f1c65288 data-v-645c36fb><div class="curtain" data-v-645c36fb></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-645c36fb><span class="visually-hidden" id="sidebar-aria-label" data-v-645c36fb> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-de301309><section class="VPSidebarItem level-0" data-v-de301309 data-v-d6f1d00b><div class="item" role="button" tabindex="0" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><h2 class="text" data-v-d6f1d00b>介绍</h2><!----></div><div class="items" data-v-d6f1d00b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>开始</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/philosophy.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>理念</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/why.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>为什么选 Vite</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-de301309><section class="VPSidebarItem level-0 has-active" data-v-de301309 data-v-d6f1d00b><div class="item" role="button" tabindex="0" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><h2 class="text" data-v-d6f1d00b>指引</h2><!----></div><div class="items" data-v-d6f1d00b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/features.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>功能</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/cli.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>命令行接口</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/using-plugins.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>使用插件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/dep-pre-bundling.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>依赖预构建</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/assets.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>静态资源处理</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/build.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>构建生产版本</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/static-deploy.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>部署静态站点</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/env-and-mode.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>环境变量与模式</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/ssr.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>服务端渲染（SSR）</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/backend-integration.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>后端集成</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/troubleshooting.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>故障排除</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/performance.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>性能</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/rolldown.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>Rolldown</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/migration.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>从 v6 迁移</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/changes/" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>破坏性变更</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-de301309><section class="VPSidebarItem level-0" data-v-de301309 data-v-d6f1d00b><div class="item" role="button" tabindex="0" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><h2 class="text" data-v-d6f1d00b>API</h2><!----></div><div class="items" data-v-d6f1d00b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/api-plugin.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>插件 API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/api-hmr.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>HMR API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/api-javascript.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>JavaScript API</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/config/" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>配置参考</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-de301309><section class="VPSidebarItem level-0" data-v-de301309 data-v-d6f1d00b><div class="item" role="button" tabindex="0" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><h2 class="text" data-v-d6f1d00b>环境 API</h2><!----></div><div class="items" data-v-d6f1d00b><!--[--><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/api-environment.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>介绍</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/api-environment-instances.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>环境实例</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/api-environment-plugins.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>插件</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/api-environment-frameworks.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>框架</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-d6f1d00b data-v-d6f1d00b><div class="item" data-v-d6f1d00b><div class="indicator" data-v-d6f1d00b></div><a class="VPLink link link" href="/guide/api-environment-runtimes.html" data-v-d6f1d00b><!--[--><p class="text" data-v-d6f1d00b>运行时</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-f1c65288 data-v-38a1f8e9><div class="VPDoc has-sidebar has-aside" data-v-38a1f8e9 data-v-0cec5931><!--[--><!--]--><div class="container" data-v-0cec5931><div class="aside" data-v-0cec5931><div class="aside-curtain" data-v-0cec5931></div><div class="aside-container" data-v-0cec5931><div class="aside-content" data-v-0cec5931><div class="VPDocAside" data-v-0cec5931 data-v-8ba8f468><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-8ba8f468 data-v-0c111748><div class="content" data-v-0c111748><div class="outline-marker" data-v-0c111748></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-0c111748>本页目录</div><ul class="VPDocOutlineItem root" data-v-0c111748 data-v-9311d4e9><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-8ba8f468></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-0cec5931><div class="content-container" data-v-0cec5931><!--[--><!--]--><main class="main" data-v-0cec5931><div style="position:relative;" class="vp-doc _guide_ssr" data-v-0cec5931><div><h1 id="server-side-rendering" tabindex="-1">服务端渲染 (SSR) <a class="header-anchor" href="#server-side-rendering" aria-label="Permalink to “服务端渲染 (SSR)”">​</a></h1><div class="tip custom-block"><p class="custom-block-title">注意</p><p>SSR 特别指支持在 Node.js 中运行相同应用程序的前端框架（例如 React、Preact、Vue 和 Svelte），将其预渲染成 HTML，最后在客户端进行水合处理。如果你正在寻找与传统服务器端框架的集成，请查看 <a href="./backend-integration.html">后端集成指南</a>。</p><p>下面的指南还假定你在选择的框架中有使用 SSR 的经验，并且只关注特定于 Vite 的集成细节。</p></div><div class="warning custom-block"><p class="custom-block-title">底层 API</p><p>这是一个底层 API，是为库和框架作者准备的。如果你的目标是构建一个应用程序，请确保优先查看 <a href="https://github.com/vitejs/awesome-vite#ssr" target="_blank" rel="noreferrer">Vite SSR 章节</a> 中更上层的 SSR 插件和工具。也就是说，大部分应用都是基于 Vite 的底层 API 之上构建的。</p><p>目前，Vite 正在用 <a href="https://github.com/vitejs/vite/discussions/16358" target="_blank" rel="noreferrer">环境 API</a> 来改进 SSR API。查看链接了解更多详情。</p></div><h2 id="example-projects" tabindex="-1">示例项目 <a class="header-anchor" href="#example-projects" aria-label="Permalink to “示例项目”">​</a></h2><p>Vite 为服务端渲染（SSR）提供了内建支持。<a href="https://github.com/bluwy/create-vite-extra" target="_blank" rel="noreferrer"><code>create-vite-extra</code></a> 包含了一些你可以用作参考的SSR设置示例：</p><ul><li><a href="https://github.com/bluwy/create-vite-extra/tree/master/template-ssr-vanilla" target="_blank" rel="noreferrer">Vanilla</a></li><li><a href="https://github.com/bluwy/create-vite-extra/tree/master/template-ssr-vue" target="_blank" rel="noreferrer">Vue</a></li><li><a href="https://github.com/bluwy/create-vite-extra/tree/master/template-ssr-react" target="_blank" rel="noreferrer">React</a></li><li><a href="https://github.com/bluwy/create-vite-extra/tree/master/template-ssr-preact" target="_blank" rel="noreferrer">Preact</a></li><li><a href="https://github.com/bluwy/create-vite-extra/tree/master/template-ssr-svelte" target="_blank" rel="noreferrer">Svelte</a></li><li><a href="https://github.com/bluwy/create-vite-extra/tree/master/template-ssr-solid" target="_blank" rel="noreferrer">Solid</a></li></ul><p>你也可以通过 <a href="./#scaffolding-your-first-vite-project">运行 <code>create-vite</code></a> 在本地搭建这些项目，并在框架选项下选择 <code>Others &gt; create-vite-extra</code>。</p><h2 id="source-structure" tabindex="-1">源码结构 <a class="header-anchor" href="#source-structure" aria-label="Permalink to “源码结构”">​</a></h2><p>一个典型的 SSR 应用应该有如下的源文件结构：</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>- index.html</span></span>
<span class="line"><span>- server.js # main application server</span></span>
<span class="line"><span>- src/</span></span>
<span class="line"><span>  - main.js          # 导出环境无关的（通用的）应用代码</span></span>
<span class="line"><span>  - entry-client.js  # 将应用挂载到一个 DOM 元素上</span></span>
<span class="line"><span>  - entry-server.js  # 使用某框架的 SSR API 渲染该应用</span></span></code></pre></div><p><code>index.html</code> 将需要引用 <code>entry-client.js</code> 并包含一个占位标记供给服务端渲染时注入：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="index.html">index.html</span></div><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;app&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">&lt;!--ssr-outlet--&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">div</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;module&quot;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> src</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;/src/entry-client.js&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&lt;/</span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">script</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;</span></span></code></pre></div></div><p>你可以使用任何你喜欢的占位标记来替代 <code>&lt;!--ssr-outlet--&gt;</code>，只要它能够被正确替换。</p><h2 id="conditional-logic" tabindex="-1">情景逻辑 <a class="header-anchor" href="#conditional-logic" aria-label="Permalink to “情景逻辑”">​</a></h2><p>如果需要执行 SSR 和客户端间情景逻辑，可以使用：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark twoslash lsp" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>env</span><!--]--><div id="popper_zxqw9ely_tl04an" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>SSR</span><!--]--><div id="popper_u0k7fw1v_tl04an" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ... 仅在服务端执行的逻辑</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>这是在构建过程中被静态替换的，因此它将允许对未使用的条件分支进行摇树优化。</p><h2 id="setting-up-the-dev-server" tabindex="-1">设置开发服务器 <a class="header-anchor" href="#setting-up-the-dev-server" aria-label="Permalink to “设置开发服务器”">​</a></h2><p>在构建 SSR 应用程序时，你可能希望完全控制主服务器，并将 Vite 与生产环境脱钩。因此，建议以中间件模式使用 Vite。下面是一个关于 <a href="https://expressjs.com/" target="_blank" rel="noreferrer">express</a> 的例子：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="server.js">server.js</span></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark twoslash lsp" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>fs</span><!--]--><div id="popper_930xpfef_tl04ao" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:fs&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>path</span><!--]--><div id="popper_urfifata_tl04ao" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:path&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>fileURLToPath</span><!--]--><div id="popper_6swsbqgv_tl04ao" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;node:url&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>express</span><!--]--><div id="popper_1ex0swe9_tl04ao" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;express&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>createServer</span><!--]--><div id="popper_6he1rot1_tl04ap" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>createViteServer</span><!--]--><div id="popper_c8adgz2p_tl04ap" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>__dirname</span><!--]--><div id="popper_giedglaw_tl04ap" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>path</span><!--]--><div id="popper_e68rhr01_tl04aq" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>dirname</span><!--]--><div id="popper_5wgglk2e_tl04aq" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>fileURLToPath</span><!--]--><div id="popper_kjmwbkh7_tl04aq" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">meta</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>url</span><!--]--><div id="popper_m82nipzl_tl04aq" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">))</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>createServer</span><!--]--><div id="popper_lmzueau5_tl04aq" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>app</span><!--]--><div id="popper_pspyh4r8_tl04ar" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>express</span><!--]--><div id="popper_f6cm9qcx_tl04ar" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 以中间件模式创建 Vite 应用，并将 appType 配置为 &#39;custom&#39;</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 这将禁用 Vite 自身的 HTML 服务逻辑</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 并让上级服务器接管控制</span></span>
<span class="line highlighted"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>vite</span><!--]--><div id="popper_ct8eaxhq_tl04ar" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>createViteServer</span><!--]--><div id="popper_qi9m6t5e_tl04ar" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>server</span><!--]--><div id="popper_z3qn2h1q_tl04as" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: { </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>middlewareMode</span><!--]--><div id="popper_d58qkkrr_tl04as" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>appType</span><!--]--><div id="popper_7uqqlvx8_tl04as" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;custom&#39;</span></span>
<span class="line highlighted"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 使用 vite 的 Connect 实例作为中间件</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 如果你使用了自己的 express 路由（express.Router()），你应该使用 router.use</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 当服务器重启（例如用户修改了 vite.config.js 后），</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // `vite.middlewares` 仍将保持相同的引用</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // （带有 Vite 和插件注入的新的内部中间件堆栈）。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // 即使在重新启动后，以下内容仍然有效。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>app</span><!--]--><div id="popper_7lmsg6pp_tl04as" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>use</span><!--]--><div id="popper_pv4azi8v_tl04as" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>vite</span><!--]--><div id="popper_9c9l2z7r_tl04at" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>middlewares</span><!--]--><div id="popper_o7gnpmkw_tl04at" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>app</span><!--]--><div id="popper_7b1jvckw_tl04at" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>use</span><!--]--><div id="popper_g7dgx3wt_tl04at" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*all&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>req</span><!--]--><div id="popper_d5nzlegi_tl04at" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>res</span><!--]--><div id="popper_p6chr88f_tl04au" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 服务 index.html - 下面我们来处理这个问题</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  })</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>app</span><!--]--><div id="popper_7hpt0vsv_tl04au" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>listen</span><!--]--><div id="popper_j5jcxezc_tl04au" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5173</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>createServer</span><!--]--><div id="popper_nni42zhn_tl04au" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">()</span></span></code></pre></div></div><p>这里 <code>vite</code> 是 <a href="./api-javascript.html#vitedevserver">ViteDevServer</a> 的一个实例。<code>vite.middlewares</code> 是一个 <a href="https://github.com/senchalabs/connect" target="_blank" rel="noreferrer">Connect</a> 实例，它可以在任何一个兼容 connect 的 Node.js 框架中被用作一个中间件。</p><p>下一步是实现 <code>*</code> 处理程序供给服务端渲染的 HTML：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="server.js">server.js</span></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark twoslash lsp" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>app</span><!--]--><div id="popper_8we85l4s_tl04au" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>use</span><!--]--><div id="popper_exee6qgr_tl04av" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;*all&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">async</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>req</span><!--]--><div id="popper_mls0tgbt_tl04av" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>res</span><!--]--><div id="popper_zkl9pv6d_tl04av" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>next</span><!--]--><div id="popper_bf8q4v6q_tl04av" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>url</span><!--]--><div id="popper_0o07mepi_tl04aw" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>req</span><!--]--><div id="popper_ms6m2uma_tl04aw" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>originalUrl</span><!--]--><div id="popper_qm20u7x6_tl04aw" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 1. 读取 index.html</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    let</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>template</span><!--]--><div id="popper_jyrpk6ru_tl04aw" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>fs</span><!--]--><div id="popper_er9s8s70_tl04aw" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>readFileSync</span><!--]--><div id="popper_qum8lrb1_tl04ax" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>path</span><!--]--><div id="popper_syswil6p_tl04ax" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>resolve</span><!--]--><div id="popper_b2bmos4e_tl04ax" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>__dirname</span><!--]--><div id="popper_bh2lrihe_tl04ax" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;index.html&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">),</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">      &#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 2. 应用 Vite HTML 转换。这将会注入 Vite HMR 客户端，</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    同时也会从 Vite 插件应用 HTML 转换。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    例如：@vitejs/plugin-react 中的 global preambles</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>template</span><!--]--><div id="popper_p9iu0duf_tl04ax" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>vite</span><!--]--><div id="popper_gz91lqtu_tl04ay" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>transformIndexHtml</span><!--]--><div id="popper_s6caw7ij_tl04ay" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>url</span><!--]--><div id="popper_l84bys45_tl04ay" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>template</span><!--]--><div id="popper_1csllbjh_tl04ay" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 3. 加载服务器入口。vite.ssrLoadModule 将自动转换</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    你的 ESM 源码使之可以在 Node.js 中运行！无需打包</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    并提供了一种高效的模块失效机制，类似于模块热替换（HMR）。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>render</span><!--]--><div id="popper_9ipnq4e5_tl04ay" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>vite</span><!--]--><div id="popper_77u0wgcx_tl04az" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>ssrLoadModule</span><!--]--><div id="popper_4xnnyac5_tl04az" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/src/entry-server.js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 4. 渲染应用的 HTML。这假设 entry-server.js 导出的 `render`</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    函数调用了适当的 SSR 框架 API。</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    //    例如 ReactDOMServer.renderToString()</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>appHtml</span><!--]--><div id="popper_azr9kad6_tl04az" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>render</span><!--]--><div id="popper_ru4drf3h_tl04az" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>url</span><!--]--><div id="popper_hp7if1yj_tl04az" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 5. 注入渲染后的应用程序 HTML 到模板中。</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>html</span><!--]--><div id="popper_qzydjg25_tl04b0" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>template</span><!--]--><div id="popper_6bjkzsbc_tl04b0" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>replace</span><!--]--><div id="popper_0b59t1ao_tl04b0" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">`&lt;!--ssr-outlet--&gt;`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>appHtml</span><!--]--><div id="popper_col23ej6_tl04b0" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 6. 返回渲染后的 HTML。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>res</span><!--]--><div id="popper_k6ers6ph_tl04b0" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>status</span><!--]--><div id="popper_afbv5k7g_tl04b1" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">200</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>set</span><!--]--><div id="popper_8sycwbq6_tl04b1" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Content-Type&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;text/html&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }).</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>end</span><!--]--><div id="popper_jas26dam_tl04b1" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>html</span><!--]--><div id="popper_7ewb17zv_tl04b1" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">catch</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>e</span><!--]--><div id="popper_4maq06rj_tl04b1" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 如果捕获到了一个错误，让 Vite 来修复该堆栈，这样它就可以映射回</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // 你的实际源码中。</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>vite</span><!--]--><div id="popper_7ye19c29_tl04b2" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>ssrFixStacktrace</span><!--]--><div id="popper_659auyxa_tl04b2" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>e</span><!--]--><div id="popper_o1igaf5h_tl04b2" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>next</span><!--]--><div id="popper_5hr56xlh_tl04b2" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>e</span><!--]--><div id="popper_c54bblj6_tl04b2" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div><p><code>package.json</code> 中的 <code>dev</code> 脚本也应该相应地改变，使用服务器脚本：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="package.json">package.json</span></div><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  &quot;scripts&quot;: {</span></span>
<span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">-   &quot;dev&quot;: &quot;vite&quot;</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+   &quot;dev&quot;: &quot;node server&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span></code></pre></div></div><h2 id="building-for-production" tabindex="-1">生产环境构建 <a class="header-anchor" href="#building-for-production" aria-label="Permalink to “生产环境构建”">​</a></h2><p>为了将 SSR 项目交付生产，我们需要：</p><ol><li>正常生成一个客户端构建；</li><li>再生成一个 SSR 构建，使其通过 <code>import()</code> 直接加载，这样便无需再使用 Vite 的 <code>ssrLoadModule</code>；</li></ol><p><code>package.json</code> 中的脚本应该看起来像这样：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="package.json">package.json</span></div><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;scripts&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;dev&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;node server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build:client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vite build --outDir dist/client&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;build:server&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;vite build --outDir dist/server --ssr src/entry-server.js&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div></div><p>注意使用 <code>--ssr</code> 标志表明这将会是一个 SSR 构建。同时需要指定 SSR 的入口。</p><p>接着，在 <code>server.js</code> 中，通过 <code>process.env.NODE_ENV</code> 条件分支，需要添加一些用于生产环境的特定逻辑：</p><ul><li><p>使用 <code>dist/client/index.html</code> 作为模板，而不是根目录的 <code>index.html</code>，因为前者包含了到客户端构建的正确资源链接。</p></li><li><p>使用 <code>import(&#39;./dist/server/entry-server.js&#39;)</code> （该文件是 SSR 构建产物），而不是使用 <code>await vite.ssrLoadModule(&#39;/src/entry-server.js&#39;)</code>。</p></li><li><p>将 <code>vite</code> 开发服务器的创建和所有使用都移到 dev-only 条件分支后面，然后添加静态文件服务中间件来服务 <code>dist/client</code> 中的文件。</p></li></ul><p>可以参考 <a href="#example-projects">示例项目</a> 以获取一个可运行的设置。</p><h2 id="generating-preload-directives" tabindex="-1">生成预加载指令 <a class="header-anchor" href="#generating-preload-directives" aria-label="Permalink to “生成预加载指令”">​</a></h2><p><code>vite build</code> 支持使用 <code>--ssrManifest</code> 标志，这将会在构建输出目录中生成一份 <code>.vite/ssr-manifest.json</code>：</p><div class="language-diff"><button title="Copy Code" class="copy"></button><span class="lang">diff</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#B31D28;--shiki-dark:#FDAEB7;">- &quot;build:client&quot;: &quot;vite build --outDir dist/client&quot;,</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">+ &quot;build:client&quot;: &quot;vite build --outDir dist/client --ssrManifest&quot;,</span></span></code></pre></div><p>上面的脚本将会为客户端构建生成 <code>dist/client/.vite/ssr-manifest.json</code>（是的，该 SSR 清单是从客户端构建生成而来，因为我们想要将模块 ID 映射到客户端文件上）。清单包含模块 ID 到它们关联的 chunk 和资源文件的映射。</p><p>为了利用该清单，框架需要提供一种方法来收集在服务端渲染调用期间使用到的组件模块 ID。</p><p><code>@vitejs/plugin-vue</code> 支持该功能，开箱即用，并会自动注册使用的组件模块 ID 到相关的 Vue SSR 上下文：</p><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="src/entry-server.js">src/entry-server.js</span></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> ctx</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> html</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> await</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> vueServerRenderer.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">renderToString</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(app, ctx)</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// ctx.modules 现在是一个渲染期间使用的模块 ID 的 Set</span></span></code></pre></div></div><p>我们现在需要在 <code>server.js</code> 的生产环境分支下读取该清单，并将其传递到 <code>src/entry-server.js</code> 导出的 <code>render</code> 函数中。这将为我们提供足够的信息，来为异步路由相应的文件渲染预加载指令！查看 <a href="https://github.com/vitejs/vite-plugin-vue/blob/main/playground/ssr-vue/src/entry-server.js" target="_blank" rel="noreferrer">示例代码</a> 获取完整示例。你还可以利用 <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/103" target="_blank" rel="noreferrer">103 Early Hints</a> 所提供的信息。</p><h2 id="pre-rendering--ssg" tabindex="-1">预渲染 / SSG <a class="header-anchor" href="#pre-rendering--ssg" aria-label="Permalink to “预渲染 / SSG”">​</a></h2><p>如果预先知道某些路由所需的路由和数据，我们可以使用与生产环境 SSR 相同的逻辑将这些路由预先渲染到静态 HTML 中。这也被视为一种静态站点生成（SSG）的形式。查看 <a href="https://github.com/vitejs/vite-plugin-vue/blob/main/playground/ssr-vue/prerender.js" target="_blank" rel="noreferrer">示例渲染代码</a> 获取有效示例。</p><h2 id="ssr-externals" tabindex="-1">SSR 外部化 <a class="header-anchor" href="#ssr-externals" aria-label="Permalink to “SSR 外部化”">​</a></h2><p>当运行 SSR 时依赖会由 Vite 的 SSR 转换模块系统作外部化。这会同时提速开发与构建。</p><p>如果依赖需要被 Vite 的管道转换，例如因为其中使用了未经过转译的 Vite 特性，那么它们可以被添加到 <a href="./../config/ssr-options.html#ssr-noexternal"><code>ssr.noExternal</code></a> 中。</p><p>对于采用链接的依赖，它们将默认不会被外部化，这是为了能使其利用 Vite HMR 的优势。如果你不需要这一功效，例如，想要把这些依赖当成非链接情况来测试，你可以将其添加到 <a href="./../config/ssr-options.html#ssr-external"><code>ssr.external</code></a>。</p><div class="warning custom-block"><p class="custom-block-title">使用别名</p><p>如果你为某个包配置了一个别名，为了能使 SSR 外部化依赖功能正常工作，你可能想要使用的别名应该指的是实际的 <code>node_modules</code> 中的包。<a href="https://classic.yarnpkg.com/en/docs/cli/add/#toc-yarn-add-alias" target="_blank" rel="noreferrer">Yarn</a> 和 <a href="https://pnpm.io/aliases/" target="_blank" rel="noreferrer">pnpm</a> 都支持通过 <code>npm:</code> 前缀来设置别名。</p></div><h2 id="ssr-specific-plugin-logic" tabindex="-1">SSR 专有插件逻辑 <a class="header-anchor" href="#ssr-specific-plugin-logic" aria-label="Permalink to “SSR 专有插件逻辑”">​</a></h2><p>一些框架，如 Vue 或 Svelte，会根据客户端渲染和服务端渲染的区别，将组件编译成不同的格式。可以向以下的插件钩子中，给 Vite 传递额外的 <code>options</code> 对象，对象中包含 <code>ssr</code> 属性来支持根据情景转换：</p><ul><li><code>resolveId</code></li><li><code>load</code></li><li><code>transform</code></li></ul><p><strong>示例：</strong></p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark twoslash lsp" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> function</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>mySSRPlugin</span><!--]--><div id="popper_gloigavk_tl04b3" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">() {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>name</span><!--]--><div id="popper_11xzaldk_tl04b8" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my-ssr&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>transform</span><!--]--><div id="popper_2vhg58fz_tl04b9" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>code</span><!--]--><div id="popper_pse8sgu9_tl04b9" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>id</span><!--]--><div id="popper_4dhn5ket_tl04b9" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>options</span><!--]--><div id="popper_cngnr21x_tl04b9" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>options</span><!--]--><div id="popper_703ped7i_tl04b9" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">?.</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"><div class="v-popper v-popper--theme-twoslash v-popper--theme-dropdown twoslash-hover"><!--[--><!--[--><span>ssr</span><!--]--><div id="popper_1ay33l72_tl04ba" class="v-popper__popper v-popper--theme-twoslash v-popper--theme-dropdown shiki twoslash-floating vp-copy-ignore v-popper__popper--hidden v-popper__popper--hide-to" style="position:absolute;transform:translate3d(0px,0px,0);" aria-hidden="true" tabindex="0" data-popper-placement><div class="v-popper__backdrop"></div><div class="v-popper__wrapper" style=""><div class="v-popper__inner"><!----></div><div class="v-popper__arrow-container" style="left:0px;top:0px;"><div class="v-popper__arrow-outer"></div><div class="v-popper__arrow-inner"></div></div></div></div><!--]--></div></span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">        // 执行 ssr 专有转换...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p><code>load</code> 和 <code>transform</code> 中的 <code>options</code> 对象为可选项，rollup 目前并未使用该对象，但将来可能会用额外的元数据来扩展这些钩子函数。</p><div class="tip custom-block"><p class="custom-block-title">Note</p><p>Vite 2.7 之前的版本，会提示你 <code>ssr</code> 参数的位置不应该是 <code>options</code> 对象。目前所有主要框架和插件都已对应更新，但你可能还是会发现使用过时 API 的旧文章。</p></div><h2 id="ssr-target" tabindex="-1">SSR 构建目标 <a class="header-anchor" href="#ssr-target" aria-label="Permalink to “SSR 构建目标”">​</a></h2><p>SSR 构建的默认目标为 node 环境，但你也可以让服务运行在 Web Worker 上。每个平台的打包条目解析是不同的。你可以将<code>ssr.target</code> 设置为 <code>webworker</code>，以将目标配置为 Web Worker。</p><h2 id="ssr-bundle" tabindex="-1">SSR 构建产物 <a class="header-anchor" href="#ssr-bundle" aria-label="Permalink to “SSR 构建产物”">​</a></h2><p>在某些如 <code>webworker</code> 运行时等特殊情况中，你可能想要将你的 SSR 打包成单个 JavaScript 文件。你可以通过设置 <code>ssr.noExternal</code> 为 <code>true</code> 来启用这个行为。这将会做两件事：</p><ul><li>将所有依赖视为 <code>noExternal</code>（非外部化）</li><li>若任何 Node.js 内置内容被引入，将抛出一个错误</li></ul><h2 id="ssr-resolve-conditions" tabindex="-1">SSR Resolve Conditions <a class="header-anchor" href="#ssr-resolve-conditions" aria-label="Permalink to “SSR Resolve Conditions”">​</a></h2><p>默认情况下包的入口解析将会使用 <a href="./../config/shared-options.html#resolve-conditions"><code>resolve.conditions</code></a> 中设置的条件来进行 SSR 构建。你可以使用 <a href="./../config/ssr-options.html#ssr-resolve-conditions"><code>ssr.resolve.conditions</code></a> 和 <a href="./../config/ssr-options.html#ssr-resolve-externalconditions"><code>ssr.resolve.externalConditions</code></a> 来自定义这个行为。</p><h2 id="vite-cli" tabindex="-1">Vite CLI <a class="header-anchor" href="#vite-cli" aria-label="Permalink to “Vite CLI”">​</a></h2><p>CLI 命令 <code>$ vite dev</code> 和 <code>$ vite preview</code> 也可以用于 SSR 应用：你可以将你的 SSR 中间件通过 <a href="/guide/api-plugin.html#configureserver"><code>configureServer</code></a> 添加到开发服务器、以及通过 <a href="/guide/api-plugin.html#configurepreviewserver"><code>configurePreviewServer</code></a> 添加到预览服务器。</p><div class="tip custom-block"><p class="custom-block-title">注意</p><p>使用一个后置钩子，使得你的 SSR 中间件在 Vite 的中间件 <em>之后</em> 运行。</p></div></div></div></main><footer class="VPDocFooter" data-v-0cec5931 data-v-10405ff0><!--[--><!--]--><div class="edit-info" data-v-10405ff0><div class="edit-link" data-v-10405ff0><a class="VPLink link vp-external-link-icon no-icon edit-link-button" href="https://github.com/vitejs/docs-cn/edit/main/guide/ssr.md" target="_blank" rel="noreferrer" data-v-10405ff0><!--[--><span class="vpi-square-pen edit-link-icon" data-v-10405ff0></span> 为此页提供修改建议<!--]--></a></div><!----></div><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-10405ff0><span class="visually-hidden" id="doc-footer-aria-label" data-v-10405ff0>Pager</span><div class="pager" data-v-10405ff0><a class="VPLink link pager-link prev" href="/guide/env-and-mode.html" data-v-10405ff0><!--[--><span class="desc" data-v-10405ff0>上一页</span><span class="title" data-v-10405ff0>环境变量与模式</span><!--]--></a></div><div class="pager" data-v-10405ff0><a class="VPLink link pager-link next" href="/guide/backend-integration.html" data-v-10405ff0><!--[--><span class="desc" data-v-10405ff0>下一页</span><span class="title" data-v-10405ff0>后端集成</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><footer class="VPFooter has-sidebar" data-v-f1c65288 data-v-fb49d3cc><div class="container" data-v-fb49d3cc><p class="message" data-v-fb49d3cc><a target="_blank" href="https://www.zhcndoc.com">简中文档</a></p><p class="copyright" data-v-fb49d3cc><a rel="nofollow" target="_blank" href="https://beian.miit.gov.cn">沪ICP备2024070610号-3</a></p></div></footer><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"blog.md\":\"CRwQrZ3T\",\"blog_announcing-vite2.md\":\"gICiVPa0\",\"blog_announcing-vite3.md\":\"CAydWP4x\",\"blog_announcing-vite4-3.md\":\"DHRsLZia\",\"blog_announcing-vite4.md\":\"D26p7GTz\",\"blog_announcing-vite5-1.md\":\"CrUkLR_t\",\"blog_announcing-vite5.md\":\"CohJstOa\",\"blog_announcing-vite6.md\":\"lcR3KG-A\",\"blog_announcing-vite7.md\":\"FIEr_vXA\",\"changes_hotupdate-hook.md\":\"C93Zi4yK\",\"changes_index.md\":\"ah-uqi3o\",\"changes_per-environment-apis.md\":\"oU06O624\",\"changes_shared-plugins-during-build.md\":\"Bbk0kvgU\",\"changes_ssr-using-modulerunner.md\":\"B4MTM95B\",\"changes_this-environment-in-hooks.md\":\"BlYz-RWz\",\"config_build-options.md\":\"BzxsZZhn\",\"config_dep-optimization-options.md\":\"CVPI4frR\",\"config_index.md\":\"DrYrQheP\",\"config_preview-options.md\":\"DGsW0Vaz\",\"config_server-options.md\":\"Drqp-N2-\",\"config_shared-options.md\":\"jzMOceN0\",\"config_ssr-options.md\":\"Cxdjoqdb\",\"config_worker-options.md\":\"DRhjz_S1\",\"guide_api-environment-frameworks.md\":\"Cb-7xEpo\",\"guide_api-environment-instances.md\":\"CX5xeedV\",\"guide_api-environment-plugins.md\":\"D7wp0A5M\",\"guide_api-environment-runtimes.md\":\"zo1abcdI\",\"guide_api-environment.md\":\"BOdU5GIy\",\"guide_api-hmr.md\":\"s6vUVxox\",\"guide_api-javascript.md\":\"DqXa3iHs\",\"guide_api-plugin.md\":\"pajcRMpY\",\"guide_api-vite-runtime.md\":\"C0F1nIUd\",\"guide_assets.md\":\"kc5bsqzU\",\"guide_backend-integration.md\":\"DSuO12rW\",\"guide_build.md\":\"CrWgyKfP\",\"guide_cli.md\":\"C98hGVXB\",\"guide_comparisons.md\":\"BRlF6poJ\",\"guide_dep-pre-bundling.md\":\"DoBN7mAu\",\"guide_env-and-mode.md\":\"CvmLnc0u\",\"guide_features.md\":\"BnqtM7iD\",\"guide_index.md\":\"BLJlPHGf\",\"guide_migration-from-v1.md\":\"DOwg4SZy\",\"guide_migration-from-v2.md\":\"O9STsutL\",\"guide_migration-from-v3.md\":\"Cp-zM_w5\",\"guide_migration-from-v4.md\":\"DvSFqLAk\",\"guide_migration-from-v5.md\":\"C80Lbzxf\",\"guide_migration.md\":\"BsD6Md67\",\"guide_performance.md\":\"Bwzt1xvy\",\"guide_philosophy.md\":\"CCcCDRQj\",\"guide_rolldown.md\":\"0LtMAy3c\",\"guide_ssr.md\":\"D03Fe-Ga\",\"guide_static-deploy.md\":\"CD-2PVeD\",\"guide_troubleshooting.md\":\"Zvr_QBjk\",\"guide_using-plugins.md\":\"BLr6IRUa\",\"guide_why.md\":\"c2f-zqLx\",\"index.md\":\"CjHnMomb\",\"plugins_index.md\":\"DL9nZFET\",\"readme.md\":\"ENZacRhk\",\"releases.md\":\"CBi97eWN\",\"team.md\":\"jELLzI4A\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"zh-CN\",\"dir\":\"ltr\",\"title\":\"Vite 中文文档\",\"titleTemplate\":\":title - Vite 中文文档\",\"description\":\"下一代前端工具链\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/logo.svg\",\"editLink\":{\"pattern\":\"https://github.com/vitejs/docs-cn/edit/main/:path\",\"text\":\"为此页提供修改建议\"},\"outline\":{\"label\":\"本页目录\",\"level\":[2,3]},\"socialLinks\":[{\"icon\":\"bluesky\",\"link\":\"https://bsky.app/profile/vite.dev\"},{\"icon\":\"mastodon\",\"link\":\"https://elk.zone/m.webtoo.ls/@vite\"},{\"icon\":\"x\",\"link\":\"https://x.com/vite_js\"},{\"icon\":\"discord\",\"link\":\"https://chat.vite.dev\"},{\"icon\":\"github\",\"link\":\"https://github.com/vitejs/vite\"}],\"search\":{\"provider\":\"local\",\"options\":{\"translations\":{\"button\":{\"buttonText\":\"搜索\",\"buttonAriaLabel\":\"搜索\"},\"modal\":{\"footer\":{\"selectText\":\"选择\",\"navigateText\":\"切换\",\"closeText\":\"关闭\"}}}}},\"docFooter\":{\"prev\":\"上一页\",\"next\":\"下一页\"},\"footer\":{\"message\":\"<a target=\\\"_blank\\\" href=\\\"https://www.zhcndoc.com\\\">简中文档</a>\",\"copyright\":\"<a rel=\\\"nofollow\\\" target=\\\"_blank\\\" href=\\\"https://beian.miit.gov.cn\\\">沪ICP备2024070610号-3</a>\"},\"nav\":[{\"component\":\"ReleaseTag\"},{\"text\":\"指引\",\"link\":\"/guide/\",\"activeMatch\":\"/guide/\"},{\"text\":\"配置\",\"link\":\"/config/\",\"activeMatch\":\"/config/\"},{\"text\":\"插件\",\"link\":\"/plugins/\",\"activeMatch\":\"/plugins/\"},{\"text\":\"相关链接\",\"items\":[{\"text\":\"团队成员\",\"link\":\"/team\"},{\"text\":\"最新博客\",\"link\":\"/blog\"},{\"text\":\"发布策略\",\"link\":\"/releases\"},{\"text\":\"纪录片\",\"link\":\"https://www.youtube.com/watch?v=bmWQqAKLgT4\"},{\"items\":[{\"text\":\"Bluesky\",\"link\":\"https://bsky.app/profile/vite.dev\"},{\"text\":\"Mastodon\",\"link\":\"https://elk.zone/m.webtoo.ls/@vite\"},{\"text\":\"X\",\"link\":\"https://x.com/vite_js\"},{\"text\":\"Discord 聊天室\",\"link\":\"https://chat.vite.dev\"},{\"text\":\"Awesome Vite\",\"link\":\"https://github.com/vitejs/awesome-vite\"},{\"text\":\"ViteConf\",\"link\":\"https://viteconf.org\"},{\"text\":\"Dev.to 社区\",\"link\":\"https://dev.to/t/vite\"},{\"text\":\"更新日志\",\"link\":\"https://github.com/vitejs/vite/blob/main/packages/vite/CHANGELOG.md\"},{\"text\":\"贡献指南\",\"link\":\"https://github.com/vitejs/vite/blob/main/CONTRIBUTING.md\"}]}]},{\"text\":\"历史版本\",\"items\":[{\"text\":\"Vite v6 文档（英文）\",\"link\":\"https://v6.vite.dev\"},{\"text\":\"Vite v5 文档（英文）\",\"link\":\"https://v5.vite.dev\"},{\"text\":\"Vite v4 文档（英文）\",\"link\":\"https://v4.vite.dev\"},{\"text\":\"Vite v3 文档（英文）\",\"link\":\"https://v3.vite.dev\"},{\"text\":\"Vite v2 文档（英文）\",\"link\":\"https://v2.vite.dev\"}]}],\"sidebar\":{\"/guide/\":[{\"text\":\"介绍\",\"items\":[{\"text\":\"开始\",\"link\":\"/guide/\"},{\"text\":\"理念\",\"link\":\"/guide/philosophy\"},{\"text\":\"为什么选 Vite\",\"link\":\"/guide/why\"}]},{\"text\":\"指引\",\"items\":[{\"text\":\"功能\",\"link\":\"/guide/features\"},{\"text\":\"命令行接口\",\"link\":\"/guide/cli\"},{\"text\":\"使用插件\",\"link\":\"/guide/using-plugins\"},{\"text\":\"依赖预构建\",\"link\":\"/guide/dep-pre-bundling\"},{\"text\":\"静态资源处理\",\"link\":\"/guide/assets\"},{\"text\":\"构建生产版本\",\"link\":\"/guide/build\"},{\"text\":\"部署静态站点\",\"link\":\"/guide/static-deploy\"},{\"text\":\"环境变量与模式\",\"link\":\"/guide/env-and-mode\"},{\"text\":\"服务端渲染（SSR）\",\"link\":\"/guide/ssr\"},{\"text\":\"后端集成\",\"link\":\"/guide/backend-integration\"},{\"text\":\"故障排除\",\"link\":\"/guide/troubleshooting\"},{\"text\":\"性能\",\"link\":\"/guide/performance\"},{\"text\":\"Rolldown\",\"link\":\"/guide/rolldown\"},{\"text\":\"从 v6 迁移\",\"link\":\"/guide/migration\"},{\"text\":\"破坏性变更\",\"link\":\"/changes/\"}]},{\"text\":\"API\",\"items\":[{\"text\":\"插件 API\",\"link\":\"/guide/api-plugin\"},{\"text\":\"HMR API\",\"link\":\"/guide/api-hmr\"},{\"text\":\"JavaScript API\",\"link\":\"/guide/api-javascript\"},{\"text\":\"配置参考\",\"link\":\"/config/\"}]},{\"text\":\"环境 API\",\"items\":[{\"text\":\"介绍\",\"link\":\"/guide/api-environment\"},{\"text\":\"环境实例\",\"link\":\"/guide/api-environment-instances\"},{\"text\":\"插件\",\"link\":\"/guide/api-environment-plugins\"},{\"text\":\"框架\",\"link\":\"/guide/api-environment-frameworks\"},{\"text\":\"运行时\",\"link\":\"/guide/api-environment-runtimes\"}]}],\"/config/\":[{\"text\":\"配置\",\"items\":[{\"text\":\"配置 Vite\",\"link\":\"/config/\"},{\"text\":\"共享选项\",\"link\":\"/config/shared-options\"},{\"text\":\"服务器选项\",\"link\":\"/config/server-options\"},{\"text\":\"构建选项\",\"link\":\"/config/build-options\"},{\"text\":\"预览选项\",\"link\":\"/config/preview-options\"},{\"text\":\"依赖优化选项\",\"link\":\"/config/dep-optimization-options\"},{\"text\":\"SSR 选项\",\"link\":\"/config/ssr-options\"},{\"text\":\"Worker 选项\",\"link\":\"/config/worker-options\"}]}],\"/changes/\":[{\"text\":\"破坏性变更\",\"link\":\"/changes/\"},{\"text\":\"现在\",\"items\":[]},{\"text\":\"未来\",\"items\":[{\"text\":\"钩子函数中的 this.environment\",\"link\":\"/changes/this-environment-in-hooks\"},{\"text\":\"HMR hotUpdate 插件钩子\",\"link\":\"/changes/hotupdate-hook\"},{\"text\":\"迁移到基于环境的API\",\"link\":\"/changes/per-environment-apis\"},{\"text\":\"使用 ModuleRunner API 进行服务端渲染\",\"link\":\"/changes/ssr-using-modulerunner\"},{\"text\":\"构建过程中的共享插件\",\"link\":\"/changes/shared-plugins-during-build\"}]},{\"text\":\"过去\",\"items\":[]}]}},\"locales\":{\"root\":{\"label\":\"简体中文\"},\"en\":{\"label\":\"English\",\"link\":\"https://vite.dev\"},\"ja\":{\"label\":\"日本語\",\"link\":\"https://ja.vite.dev\"},\"es\":{\"label\":\"Español\",\"link\":\"https://es.vite.dev\"},\"pt\":{\"label\":\"Português\",\"link\":\"https://pt.vite.dev\"},\"ko\":{\"label\":\"한국어\",\"link\":\"https://ko.vite.dev\"},\"de\":{\"label\":\"Deutsch\",\"link\":\"https://de.vite.dev\"},\"fa\":{\"label\":\"فارسی\",\"link\":\"https://fa.vite.dev\"}},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>