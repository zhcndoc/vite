import{_ as n,b as r,o,i as d,j as s,S as e,g as l,R as t}from"./chunks/framework.Caqowgrb.js";const C=JSON.parse('{"title":"从 v7 迁移","description":"","frontmatter":{},"headers":[],"relativePath":"guide/migration.md","filePath":"guide/migration.md"}'),p={name:"guide/migration.md"},h={id:"default-browser-target-change",tabindex:"-1"},k={href:"#migration-from-v7"},c={id:"removed-deprecated-features",tabindex:"-1"},g={href:"#migration-from-v7"};function u(b,i,E,f,y,F){const a=r("Badge");return o(),d("div",null,[i[10]||(i[10]=s("h1",{id:"migration-from-v7",tabindex:"-1"},[e("从 v7 迁移 "),s("a",{class:"header-anchor",href:"#migration-from-v7","aria-label":"Permalink to “从 v7 迁移”"},"​")],-1)),s("p",null,[i[0]||(i[0]=e("如果正在从 ",-1)),i[1]||(i[1]=s("code",null,"rolldown-vite",-1)),i[2]||(i[2]=e(" 进行迁移，那么只有标题中包含 ",-1)),l(a,{text:"NRV",type:"warning"}),i[3]||(i[3]=e(" 的部分适用。",-1))]),s("h2",h,[i[4]||(i[4]=e("浏览器兼容性目标变更 ",-1)),s("a",k,[l(a,{text:"NRV",type:"warning"})]),i[5]||(i[5]=e()),i[6]||(i[6]=s("a",{class:"header-anchor",href:"#default-browser-target-change","aria-label":"Permalink to “浏览器兼容性目标变更”"},"​",-1))]),i[11]||(i[11]=t(`<p><code>build.target</code> 和 <code>&#39;baseline-widely-available&#39;</code> 的默认浏览器值已更新为较新的浏览器版本：</p><ul><li>Chrome 107 → 111</li><li>Edge 107 → 111</li><li>Firefox 104 → 114</li><li>Safari 16.0 → 16.4</li></ul><p>这些浏览器版本符合 <a href="https://web-platform-dx.github.io/web-features/" target="_blank" rel="noreferrer">Baseline</a> 在 2026-01-01 时定义的“广泛可用”功能集标准。换句话说，它们都是大约两年半前发布的。</p><h2 id="rolldown" tabindex="-1">Rolldown <a class="header-anchor" href="#rolldown" aria-label="Permalink to “Rolldown”">​</a></h2><p>Vite 8 使用基于 <a href="https://rolldown.rs/" target="_blank" rel="noreferrer">Rolldown</a> 和 <a href="https://oxc.rs/" target="_blank" rel="noreferrer">Oxc</a> 的工具，而不是 <a href="https://esbuild.github.io/" target="_blank" rel="noreferrer">esbuild</a> 和 <a href="https://rollupjs.org/" target="_blank" rel="noreferrer">Rollup</a>。</p><h3 id="gradual-migration" tabindex="-1">渐进式迁移 <a class="header-anchor" href="#gradual-migration" aria-label="Permalink to “渐进式迁移”">​</a></h3><p><code>rolldown-vite</code> 包实现了使用 Rolldown 的 Vite 7，但不包含其他 Vite 8 的变更。这可以作为迁移到 Vite 8 的中间步骤。请参阅 Vite 7 文档中的 <a href="https://v7.vite.dev/guide/rolldown" target="_blank" rel="noreferrer">Rolldown 集成指南</a> 了解如何从 Vite 7 切换到 <code>rolldown-vite</code>。</p><p>对于从 <code>rolldown-vite</code> 迁移到 Vite 8 的用户，你可以撤销 <code>package.json</code> 中的依赖变更并更新到 Vite 8：</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark has-diff" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">  &quot;devDependencies&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: {</span></span>
<span class="line diff remove"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;vite&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;npm:rolldown-vite@7.2.2&quot;</span></span>
<span class="line diff add"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;vite&quot;</span><span style="--shiki-light:#B31D28;--shiki-light-font-style:italic;--shiki-dark:#FDAEB7;--shiki-dark-font-style:italic;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;^8.0.0&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="dependency-optimizer-now-uses-rolldown" tabindex="-1">依赖优化器现在使用 Rolldown <a class="header-anchor" href="#dependency-optimizer-now-uses-rolldown" aria-label="Permalink to “依赖优化器现在使用 Rolldown”">​</a></h3><p>现在依赖优化使用 Rolldown 而不是 esbuild。Vite 仍然通过自动将 <a href="/config/dep-optimization-options#optimizedeps-esbuildoptions"><code>optimizeDeps.esbuildOptions</code></a> 转换为 <a href="/config/dep-optimization-options#optimizedeps-rolldownoptions"><code>optimizeDeps.rolldownOptions</code></a> 来支持向后兼容。<code>optimizeDeps.esbuildOptions</code> 现在已被弃用，将来会被移除，我们鼓励您迁移到 <code>optimizeDeps.rolldownOptions</code>。</p><p>以下选项会自动转换：</p><ul><li><a href="https://esbuild.github.io/api/#minify" target="_blank" rel="noreferrer"><code>esbuildOptions.minify</code></a> -&gt; <a href="https://rolldown.rs/reference/OutputOptions.minify" target="_blank" rel="noreferrer"><code>rolldownOptions.output.minify</code></a></li><li><a href="https://esbuild.github.io/api/#tree-shaking" target="_blank" rel="noreferrer"><code>esbuildOptions.treeShaking</code></a> -&gt; <a href="https://rolldown.rs/reference/InputOptions.treeshake" target="_blank" rel="noreferrer"><code>rolldownOptions.treeshake</code></a></li><li><a href="https://esbuild.github.io/api/#define" target="_blank" rel="noreferrer"><code>esbuildOptions.define</code></a> -&gt; <a href="https://rolldown.rs/reference/InputOptions.transform#define" target="_blank" rel="noreferrer"><code>rolldownOptions.transform.define</code></a></li><li><a href="https://esbuild.github.io/api/#loader" target="_blank" rel="noreferrer"><code>esbuildOptions.loader</code></a> -&gt; <a href="https://rolldown.rs/reference/InputOptions.moduleTypes" target="_blank" rel="noreferrer"><code>rolldownOptions.moduleTypes</code></a></li><li><a href="https://esbuild.github.io/api/#preserve-symlinks" target="_blank" rel="noreferrer"><code>esbuildOptions.preserveSymlinks</code></a> -&gt; <a href="https://rolldown.rs/reference/InputOptions.resolve#symlinks" target="_blank" rel="noreferrer"><code>!rolldownOptions.resolve.symlinks</code></a></li><li><a href="https://esbuild.github.io/api/#resolve-extensions" target="_blank" rel="noreferrer"><code>esbuildOptions.resolveExtensions</code></a> -&gt; <a href="https://rolldown.rs/reference/InputOptions.resolve#extensions" target="_blank" rel="noreferrer"><code>rolldownOptions.resolve.extensions</code></a></li><li><a href="https://esbuild.github.io/api/#main-fields" target="_blank" rel="noreferrer"><code>esbuildOptions.mainFields</code></a> -&gt; <a href="https://rolldown.rs/reference/InputOptions.resolve#mainfields" target="_blank" rel="noreferrer"><code>rolldownOptions.resolve.mainFields</code></a></li><li><a href="https://esbuild.github.io/api/#conditions" target="_blank" rel="noreferrer"><code>esbuildOptions.conditions</code></a> -&gt; <a href="https://rolldown.rs/reference/InputOptions.resolve#conditionnames" target="_blank" rel="noreferrer"><code>rolldownOptions.resolve.conditionNames</code></a></li><li><a href="https://esbuild.github.io/api/#keep-names" target="_blank" rel="noreferrer"><code>esbuildOptions.keepNames</code></a> -&gt; <a href="https://rolldown.rs/reference/OutputOptions.keepNames" target="_blank" rel="noreferrer"><code>rolldownOptions.output.keepNames</code></a></li><li><a href="https://esbuild.github.io/api/#platform" target="_blank" rel="noreferrer"><code>esbuildOptions.platform</code></a> -&gt; <a href="https://rolldown.rs/reference/InputOptions.platform" target="_blank" rel="noreferrer"><code>rolldownOptions.platform</code></a></li><li><a href="https://esbuild.github.io/plugins/" target="_blank" rel="noreferrer"><code>esbuildOptions.plugins</code></a> -&gt; <a href="https://rolldown.rs/reference/InputOptions.plugins" target="_blank" rel="noreferrer"><code>rolldownOptions.plugins</code></a> (partial support)</li></ul><p>你可以从 <code>configResolved</code> 钩子中获取由兼容层设置的选项：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> plugin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;log-config&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  configResolved</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;options&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, config.optimizeDeps.rolldownOptions)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span></code></pre></div><h3 id="javascript-transforms-by-oxc" tabindex="-1">使用 Oxc 转换 JavaScript <a class="header-anchor" href="#javascript-transforms-by-oxc" aria-label="Permalink to “使用 Oxc 转换 JavaScript”">​</a></h3><p>现在使用 Oxc 进行 JavaScript 转换，而不是 esbuild。Vite 仍然通过自动将 <a href="/config/shared-options#esbuild"><code>esbuild</code></a> 选项转换为 <a href="/config/shared-options#oxc"><code>oxc</code></a> 来支持向后兼容。<code>esbuild</code> 现在已被弃用，将来会被移除，我们鼓励您迁移到 <code>oxc</code>。</p><p>以下选项会自动转换：</p><ul><li><code>esbuild.jsxInject</code> -&gt; <code>oxc.jsxInject</code></li><li><code>esbuild.include</code> -&gt; <code>oxc.include</code></li><li><code>esbuild.exclude</code> -&gt; <code>oxc.exclude</code></li><li><a href="https://esbuild.github.io/api/#jsx" target="_blank" rel="noreferrer"><code>esbuild.jsx</code></a> -&gt; <a href="https://oxc.rs/docs/guide/usage/transformer/jsx" target="_blank" rel="noreferrer"><code>oxc.jsx</code></a><ul><li><code>esbuild.jsx: &#39;preserve&#39;</code> -&gt; <code>oxc.jsx: &#39;preserve&#39;</code></li><li><code>esbuild.jsx: &#39;automatic&#39;</code> -&gt; <code>oxc.jsx: { runtime: &#39;automatic&#39; }</code><ul><li><a href="https://esbuild.github.io/api/#jsx-import-source" target="_blank" rel="noreferrer"><code>esbuild.jsxImportSource</code></a> -&gt; <code>oxc.jsx.importSource</code></li></ul></li><li><code>esbuild.jsx: &#39;transform&#39;</code> -&gt; <code>oxc.jsx: { runtime: &#39;classic&#39; }</code><ul><li><a href="https://esbuild.github.io/api/#jsx-factory" target="_blank" rel="noreferrer"><code>esbuild.jsxFactory</code></a> -&gt; <code>oxc.jsx.pragma</code></li><li><a href="https://esbuild.github.io/api/#jsx-fragment" target="_blank" rel="noreferrer"><code>esbuild.jsxFragment</code></a> -&gt; <code>oxc.jsx.pragmaFrag</code></li></ul></li><li><a href="https://esbuild.github.io/api/#jsx-dev" target="_blank" rel="noreferrer"><code>esbuild.jsxDev</code></a> -&gt; <code>oxc.jsx.development</code></li><li><a href="https://esbuild.github.io/api/#jsx-side-effects" target="_blank" rel="noreferrer"><code>esbuild.jsxSideEffects</code></a> -&gt; <code>oxc.jsx.pure</code></li></ul></li><li><a href="https://esbuild.github.io/api/#define" target="_blank" rel="noreferrer"><code>esbuild.define</code></a> -&gt; <a href="https://oxc.rs/docs/guide/usage/transformer/global-variable-replacement#define" target="_blank" rel="noreferrer"><code>oxc.define</code></a></li><li><a href="https://esbuild.github.io/api/#banner" target="_blank" rel="noreferrer"><code>esbuild.banner</code></a> -&gt; 使用 transform 钩子的自定义插件</li><li><a href="https://esbuild.github.io/api/#footer" target="_blank" rel="noreferrer"><code>esbuild.footer</code></a> -&gt; 使用 transform 钩子的自定义插件</li></ul><p><a href="https://esbuild.github.io/api/#supported" target="_blank" rel="noreferrer"><code>esbuild.supported</code></a> 选项不被 Oxc 支持。如果你需要这个选项，请查看 <a href="https://github.com/oxc-project/oxc/issues/15373" target="_blank" rel="noreferrer">oxc-project/oxc#15373</a>。</p><p>你可以从 <code>configResolved</code> 钩子中获取由兼容层设置的选项：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> plugin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;log-config&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  configResolved</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;options&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, config.oxc)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">},</span></span></code></pre></div><p>目前，Oxc 转换器不支持降低原生装饰器，因为我们正在等待规范的进展，参见 (<a href="https://github.com/oxc-project/oxc/issues/9170" target="_blank" rel="noreferrer">oxc-project/oxc#9170</a>)。</p><details class="details custom-block"><summary>降低原生装饰器的解决方法</summary><p>目前你可以使用 <a href="https://babeljs.io/" target="_blank" rel="noreferrer">Babel</a> 或 <a href="https://swc.rs/" target="_blank" rel="noreferrer">SWC</a> 来降低原生装饰器。虽然 SWC 比 Babel 更快，但它<strong>不支持 esbuild 支持的最新装饰器规范</strong>。</p><p>自从装饰器规范达到第 3 阶段以来，已经更新了多次。每个工具支持的版本如下：</p><ul><li><code>&quot;2023-11&quot;</code>（esbuild、TypeScript 5.4+ 和 Babel 支持此版本）</li><li><code>&quot;2023-05&quot;</code>（TypeScript 5.2+ 支持此版本）</li><li><code>&quot;2023-01&quot;</code>（TypeScript 5.0+ 支持此版本）</li><li><code>&quot;2022-03&quot;</code>（SWC 支持此版本）</li></ul><p>请参阅 <a href="https://babeljs.io/docs/babel-plugin-proposal-decorators#version" target="_blank" rel="noreferrer">Babel 装饰器版本指南</a> 了解各版本之间的差异。</p><p><strong>使用 Babel:</strong></p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-260" id="tab-261" checked><label data-title="npm" for="tab-261">npm</label><input type="radio" name="group-260" id="tab-262"><label data-title="Yarn" for="tab-262">Yarn</label><input type="radio" name="group-260" id="tab-263"><label data-title="pnpm" for="tab-263">pnpm</label><input type="radio" name="group-260" id="tab-264"><label data-title="Bun" for="tab-264">Bun</label><input type="radio" name="group-260" id="tab-265"><label data-title="Deno" for="tab-265">Deno</label></div><div class="blocks"><div class="language-bash active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @rollup/plugin-babel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @babel/plugin-proposal-decorators</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @rollup/plugin-babel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @babel/plugin-proposal-decorators</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @rollup/plugin-babel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @babel/plugin-proposal-decorators</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @rollup/plugin-babel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @babel/plugin-proposal-decorators</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">deno</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm:@rollup/plugin-babel</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm:@babel/plugin-proposal-decorators</span></span></code></pre></div></div></div><div class="vp-code-block-title"><div class="vp-code-block-title-bar"><span class="vp-code-block-title-text" data-title="vite.config.ts">vite.config.ts</span></div><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig, withFilter } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { babel } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;@rollup/plugin-babel&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    withFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      babel</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        configFile: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        plugins: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@babel/plugin-proposal-decorators&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, { version: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2023-11&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Only run this transform if the file contains a decorator.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { transform: { code: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></div><p><strong>使用 SWC:</strong></p><div class="vp-code-group"><div class="tabs"><input type="radio" name="group-271" id="tab-272" checked><label data-title="npm" for="tab-272">npm</label><input type="radio" name="group-271" id="tab-273"><label data-title="Yarn" for="tab-273">Yarn</label><input type="radio" name="group-271" id="tab-274"><label data-title="pnpm" for="tab-274">pnpm</label><input type="radio" name="group-271" id="tab-275"><label data-title="Bun" for="tab-275">Bun</label><input type="radio" name="group-271" id="tab-276"><label data-title="Deno" for="tab-276">Deno</label></div><div class="blocks"><div class="language-bash active"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">npm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> install</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @rollup/plugin-swc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @swc/core</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">yarn</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @rollup/plugin-swc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @swc/core</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">pnpm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @rollup/plugin-swc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @swc/core</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @rollup/plugin-swc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> @swc/core</span></span></code></pre></div><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;user-select:none;-webkit-user-select:none;">$ </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">deno</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -D</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm:@rollup/plugin-swc</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> npm:@swc/core</span></span></code></pre></div></div></div><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig, withFilter } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    withFilter</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">      swc</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        swc: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          jsc: {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            parser: { decorators: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, decoratorsBeforeExport: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">            // NOTE: SWC doesn&#39;t support the &#39;2023-11&#39; version yet.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            transform: { decoratorVersion: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2022-03&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }),</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Only run this transform if the file contains a decorator.</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      { transform: { code: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;@&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> } },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div></details><h4 id="esbuild-fallbacks" tabindex="-1">esbuild 回退机制 <a class="header-anchor" href="#esbuild-fallbacks" aria-label="Permalink to “esbuild 回退机制”">​</a></h4><p><code>esbuild</code> 不再被 Vite 直接使用，现在是一个可选依赖。如果你正在使用一个使用 <code>transformWithEsbuild</code> 函数的插件，你需要将 <code>esbuild</code> 安装为 <code>devDependency</code>。<code>transformWithEsbuild</code> 函数已被弃用，将来会被移除。我们建议迁移到新的 <code>transformWithOxc</code> 函数。</p><h3 id="javascript-minification-by-oxc" tabindex="-1">使用 Oxc 进行 JavaScript 压缩 <a class="header-anchor" href="#javascript-minification-by-oxc" aria-label="Permalink to “使用 Oxc 进行 JavaScript 压缩”">​</a></h3><p>现在使用 Oxc 压缩器进行 JavaScript 压缩，而不是 esbuild。你可以使用已弃用的 <a href="/config/build-options#build-minify"><code>build.minify: &#39;esbuild&#39;</code></a> 选项切换回 esbuild。这个配置选项将来会被移除，你需要将 <code>esbuild</code> 安装为 <code>devDependency</code>，因为 Vite 不再直接依赖 esbuild。</p><p>如果你之前使用 <code>esbuild.minify*</code> 选项来控制压缩行为，现在可以改用 <code>build.rolldownOptions.output.minify</code>。如果你之前使用 <code>esbuild.drop</code> 选项，现在可以改用 <a href="https://oxc.rs/docs/guide/usage/minifier/dead-code-elimination" target="_blank" rel="noreferrer"><code>build.rolldownOptions.output.minify.compress.drop*</code> 选项</a>。</p><p>Oxc 不支持属性混淆及其相关选项（<a href="https://esbuild.github.io/api/#mangle-props" target="_blank" rel="noreferrer"><code>mangleProps</code>、<code>reserveProps</code>、<code>mangleQuoted</code>、<code>mangleCache</code></a>）。如果你需要这些选项，请查看 <a href="https://github.com/oxc-project/oxc/issues/15375" target="_blank" rel="noreferrer">oxc-project/oxc#15375</a>。</p><p>esbuild 和 Oxc 压缩器对源代码做出了略微不同的假设。如果你怀疑压缩器导致了代码损坏，可以在此处比较这些假设：</p><ul><li><a href="https://esbuild.github.io/api/#minify-considerations" target="_blank" rel="noreferrer">esbuild 压缩假设</a></li><li><a href="https://oxc.rs/docs/guide/usage/minifier.html#assumptions" target="_blank" rel="noreferrer">Oxc 压缩器假设</a></li></ul><p>请报告你在 JavaScript 应用程序中发现的任何与压缩相关的问题。</p><h3 id="css-minification-by-lightning-css" tabindex="-1">使用 Lightning CSS 进行 CSS 压缩 <a class="header-anchor" href="#css-minification-by-lightning-css" aria-label="Permalink to “使用 Lightning CSS 进行 CSS 压缩”">​</a></h3><p>现在默认使用 <a href="https://lightningcss.dev/" target="_blank" rel="noreferrer">Lightning CSS</a> 进行 CSS 压缩。你可以使用 <a href="/config/build-options#build-minify"><code>build.cssMinify: &#39;esbuild&#39;</code></a> 选项切换回 esbuild。请注意，你需要将 <code>esbuild</code> 安装为 <code>devDependency</code>。</p><p>Lightning CSS 支持更好的语法降级，你的 CSS 包大小可能会略有增加。</p><h3 id="consistent-commonjs-interop" tabindex="-1">一致的 CommonJS 互操作性 <a class="header-anchor" href="#consistent-commonjs-interop" aria-label="Permalink to “一致的 CommonJS 互操作性”">​</a></h3><p>现在以一致的方式处理来自 CommonJS (CJS) 模块的 <code>default</code> 导入。</p><p>如果符合以下条件之一，则 <code>default</code> 导入是被导入的 CJS 模块的 <code>module.exports</code> 值。否则，<code>default</code> 导入是被导入的 CJS 模块的 <code>module.exports.default</code> 值：</p><ul><li>导入者是 <code>.mjs</code> 或 <code>.mts</code> 文件。</li><li>导入者最近的 <code>package.json</code> 文件中 <code>type</code> 字段设置为 <code>module</code>。</li><li>被导入的 CJS 模块的 <code>module.exports.__esModule</code> 值未设置为 true。</li></ul><details class="details custom-block"><summary>之前的行为</summary><p>在开发环境中，如果符合以下条件之一，则 <code>default</code> 导入是被导入的 CJS 模块的 <code>module.exports</code> 值。否则，<code>default</code> 导入是被导入的 CJS 模块的 <code>module.exports.default</code> 值：</p><ul><li><em>导入者包含在依赖优化中</em> 且为 <code>.mjs</code> 或 <code>.mts</code> 文件。</li><li><em>导入者包含在依赖优化中</em> 且导入者最近的 <code>package.json</code> 文件中 <code>type</code> 字段设置为 <code>module</code>。</li><li>被导入的 CJS 模块的 <code>module.exports.__esModule</code> 值未设置为 true。</li></ul><p>在构建时，条件为：</p><ul><li>被导入的 CJS 模块的 <code>module.exports.__esModule</code> 值未设置为 true。</li><li><em><code>module.exports</code> 的 <code>default</code> 属性不存在</em>。</li></ul><p>(假设 <a href="https://github.com/rollup/plugins/tree/master/packages/commonjs#defaultismoduleexports" target="_blank" rel="noreferrer"><code>build.commonjsOptions.defaultIsModuleExports</code></a> 未从默认的 <code>&#39;auto&#39;</code> 更改)</p></details><p>有关此问题的更多详细信息，请参阅 Rolldown 的文档：<a href="https://rolldown.rs/in-depth/bundling-cjs#ambiguous-default-import-from-cjs-modules" target="_blank" rel="noreferrer">CJS 模块中不明确的 <code>default</code> 导入 - 打包 CJS | Rolldown</a>。</p><p>此更改可能会破坏一些现有的导入 CJS 模块的代码。你可以使用已弃用的 <code>legacy.inconsistentCjsInterop: true</code> 选项临时恢复之前的行为。如果你发现某个包受此更改影响，请向包作者报告或发送拉取请求。请确保链接上面的 Rolldown 文档，以便作者能够理解上下文。</p><h3 id="removed-module-resolution-using-format-sniffing" tabindex="-1">使用格式嗅探移除模块解析 <a class="header-anchor" href="#removed-module-resolution-using-format-sniffing" aria-label="Permalink to “使用格式嗅探移除模块解析”">​</a></h3><p>当 <code>package.json</code> 中同时存在 <code>browser</code> 和 <code>module</code> 字段时，Vite 以前会根据文件内容来解析字段，并为浏览器选择 ESM 文件。引入这一机制是因为一些包使用 <code>module</code> 字段指向 Node.js 的 ESM 文件，而其他包使用 <code>browser</code> 字段指向浏览器的 UMD 文件。鉴于现代 <code>exports</code> 字段解决了这个问题并且现在被许多包采用，Vite 不再使用这种启发式方法，而是始终遵循 <a href="/config/shared-options#resolve-mainfields"><code>resolve.mainFields</code></a> 选项的顺序。如果你依赖此行为，可以使用 <a href="/config/shared-options#resolve-alias"><code>resolve.alias</code></a> 选项将字段映射到所需的文件，或使用包管理器应用补丁（例如 <code>patch-package</code>、<code>pnpm patch</code>）。</p><h3 id="require-calls-for-externalized-modules" tabindex="-1">外部化模块的 Require 调用 <a class="header-anchor" href="#require-calls-for-externalized-modules" aria-label="Permalink to “外部化模块的 Require 调用”">​</a></h3><p>现在外部化模块的 <code>require</code> 调用会被保留为 <code>require</code> 调用，而不会被转换为 <code>import</code> 语句。这是为了保持 <code>require</code> 调用的语义。如果你想将它们转换为 <code>import</code> 语句，可以使用 <a href="https://rolldown.rs/builtin-plugins/esm-external-require" target="_blank" rel="noreferrer">Rolldown 内置的 <code>esmExternalRequirePlugin</code></a>，该插件由 <code>vite</code> 重新导出。</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { defineConfig, esmExternalRequirePlugin } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;vite&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">export</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> default</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> defineConfig</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  plugins: [</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    esmExternalRequirePlugin</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">({</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      external: [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;react&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;vue&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> /</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">^</span><span style="--shiki-light:#032F62;--shiki-dark:#DBEDFF;">node:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  ],</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">})</span></span></code></pre></div><p>有关更多详细信息，请参阅 Rolldown 的文档：<a href="https://rolldown.rs/in-depth/bundling-cjs#require-external-modules" target="_blank" rel="noreferrer"><code>require</code> 外部模块 - 打包 CJS | Rolldown</a>。</p><h3 id="import-meta-url-in-umd-iife" tabindex="-1"><code>import.meta.url</code> in UMD / IIFE <a class="header-anchor" href="#import-meta-url-in-umd-iife" aria-label="Permalink to “import.meta.url in UMD / IIFE”">​</a></h3><p>在 UMD / IIFE 输出格式中不再对 <code>import.meta.url</code> 进行 polyfill。默认情况下它将被替换为 <code>undefined</code>。如果你更喜欢之前的行为，可以使用 <a href="/config/shared-options#define"><code>define</code></a> 选项配合 <a href="https://rolldown.rs/reference/OutputOptions.intro" target="_blank" rel="noreferrer"><code>build.rolldownOptions.output.intro</code></a> 选项。有关更多详细信息，请参阅 Rolldown 的文档：<a href="https://rolldown.rs/in-depth/non-esm-output-formats#well-known-import-meta-properties" target="_blank" rel="noreferrer">知名的 <code>import.meta</code> 属性 - 非 ESM 输出格式 | Rolldown</a>。</p><h3 id="removed-build-rollupoptions-watch-chokidar-option" tabindex="-1">移除了 <code>build.rollupOptions.watch.chokidar</code> 选项 <a class="header-anchor" href="#removed-build-rollupoptions-watch-chokidar-option" aria-label="Permalink to “移除了 build.rollupOptions.watch.chokidar 选项”">​</a></h3><p><code>build.rollupOptions.watch.chokidar</code> 选项已被移除。请迁移到 <a href="https://rolldown.rs/reference/InputOptions.watch#notify" target="_blank" rel="noreferrer"><code>build.rolldownOptions.watch.notify</code></a> 选项。</p><h3 id="remove-object-form-build-rollupoptions-output-manualchunks-and-deprecate-function-form-one" tabindex="-1">从 <code>build.rollupOptions.output.manualChunks</code> 中移除对象形式，并弃用函数形式 <a class="header-anchor" href="#remove-object-form-build-rollupoptions-output-manualchunks-and-deprecate-function-form-one" aria-label="Permalink to “从 build.rollupOptions.output.manualChunks 中移除对象形式，并弃用函数形式”">​</a></h3><p><code>output.manualChunks</code> 选项的对象形式不再支持。<code>output.manualChunks</code> 的函数形式已弃用。Rolldown 提供了更灵活的 <a href="https://rolldown.rs/reference/OutputOptions.codeSplitting" target="_blank" rel="noreferrer"><code>codeSplitting</code></a> 选项。有关 <code>codeSplitting</code> 的更多详细信息，请参阅 Rolldown 的文档：<a href="https://rolldown.rs/in-depth/advanced-chunks" target="_blank" rel="noreferrer">手动代码分割 - Rolldown</a>。</p><h3 id="module-type-support-and-auto-detection" tabindex="-1">模块类型支持和自动检测 <a class="header-anchor" href="#module-type-support-and-auto-detection" aria-label="Permalink to “模块类型支持和自动检测”">​</a></h3><p><em>此更改仅影响插件作者。</em></p><p>Rolldown 对<a href="https://rolldown.rs/guide/notable-features#module-types" target="_blank" rel="noreferrer">模块类型</a>提供了实验性支持，类似于<a href="https://esbuild.github.io/api/#loader" target="_blank" rel="noreferrer">esbuild 的 <code>loader</code> 选项</a>。因此，Rolldown 会根据解析后的 ID 扩展名自动设置模块类型。如果你在 <code>load</code> 或 <code>transform</code> 钩子中将其他模块类型的内容转换为 JavaScript，你可能需要在返回值中添加 <code>moduleType: &#39;js&#39;</code>：</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki shiki-themes github-light github-dark has-diff" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> plugin</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  name: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;txt-loader&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  load</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">id</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (id.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">endsWith</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;.txt&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)) {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> content</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> fs.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">readFile</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(id, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">      return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        code: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`export default \${</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">JSON</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">stringify</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">content</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line diff add"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        moduleType: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;js&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h3 id="other-related-deprecations" tabindex="-1">其他相关弃用 <a class="header-anchor" href="#other-related-deprecations" aria-label="Permalink to “其他相关弃用”">​</a></h3><p>以下选项已被弃用，将在未来被移除：</p><ul><li><code>build.rollupOptions</code>：重命名为 <code>build.rolldownOptions</code></li><li><code>worker.rollupOptions</code>：重命名为 <code>worker.rolldownOptions</code></li><li><code>build.commonjsOptions</code>：现在无操作效果</li><li><code>build.dynamicImportVarsOptions.warnOnError</code>: 现在无操作效果</li><li><code>resolve.alias[].customResolver</code>：请改用带有 <code>resolveId</code> 钩子和 <code>enforce: &#39;pre&#39;</code> 的自定义插件。</li></ul>`,62)),s("h2",c,[i[7]||(i[7]=e("移除了已弃用的功能 ",-1)),s("a",g,[l(a,{text:"NRV",type:"warning"})]),i[8]||(i[8]=e()),i[9]||(i[9]=s("a",{class:"header-anchor",href:"#removed-deprecated-features","aria-label":"Permalink to “移除了已弃用的功能”"},"​",-1))]),i[12]||(i[12]=t('<ul><li>不再支持向 <code>import.meta.hot.accept</code> 传递 URL。请改为传递一个 id。(<a href="https://github.com/vitejs/vite/pull/21382" target="_blank" rel="noreferrer">#21382</a>)</li></ul><h2 id="advanced" tabindex="-1">进阶 <a class="header-anchor" href="#advanced" aria-label="Permalink to “进阶”">​</a></h2><p>还有其他一些只影响少数用户的破坏性更改。</p><ul><li><a href="https://github.com/micromatch/picomatch/blob/master/README.md#extglobs" target="_blank" rel="noreferrer">Extglobs</a> 尚未得到支持 (<a href="https://github.com/vitejs/rolldown-vite/issues/365" target="_blank" rel="noreferrer">rolldown-vite#365</a>)</li><li><strong>TypeScript 旧版命名空间仅部分支持</strong>：TypeScript 的旧版命名空间功能现在只得到部分支持。更多详情请参阅 <a href="https://oxc.rs/docs/guide/usage/transformer/typescript.html#partial-namespace-support" target="_blank" rel="noreferrer">Oxc 转换器的相关文档</a>。</li><li><code>define</code> 不共享对象引用：当你传递一个对象作为 <code>define</code> 的值时，每个变量都会有一个单独的对象副本。详见 <a href="https://oxc.rs/docs/guide/usage/transformer/global-variable-replacement#define" target="_blank" rel="noreferrer">Oxc 转换器的相关文档</a>。</li><li><code>bundle</code> 对象变更（<code>bundle</code> 是在 <code>generateBundle</code> / <code>writeBundle</code> 钩子中传递的对象，由 <code>build</code> 函数返回）： <ul><li>不支持赋值给 <code>bundle[foo]</code>。Rollup 也不鼓励这样做。请使用 <code>this.emitFile()</code> 代替。</li><li>引用在钩子之间不共享 (<a href="https://github.com/vitejs/rolldown-vite/issues/410" target="_blank" rel="noreferrer">rolldown-vite#410</a>)</li><li><code>structuredClone(bundle)</code> 会出现 <code>DataCloneError: #&lt;Object&gt; could not be cloned</code> 错误。这不再被支持。请使用 <code>structuredClone({ ...bundle })</code> 来克隆。(<a href="https://github.com/vitejs/rolldown-vite/issues/128" target="_blank" rel="noreferrer">rolldown-vite#128</a>)</li></ul></li><li>Rollup 中的所有并行钩子现在都作为串行钩子工作。详见 <a href="https://rolldown.rs/apis/plugin-api#sequential-hook-execution" target="_blank" rel="noreferrer">Rolldown 的文档</a>。</li><li><code>&quot;use strict&quot;;</code> 有时不会被注入。详见 <a href="https://rolldown.rs/in-depth/directives" target="_blank" rel="noreferrer">Rolldown 的文档</a>。</li><li>使用 plugin-legacy 转换到低于 ES5 的版本不受支持 (<a href="https://github.com/vitejs/rolldown-vite/issues/452" target="_blank" rel="noreferrer">rolldown-vite#452</a>)</li><li>向 <code>build.target</code> 选项传递同一浏览器的多个版本现在会报错：esbuild 会选择最新的版本，这可能不是你的本意。</li><li>Rolldown 缺少支持：以下功能不受 Rolldown 支持，Vite 也不再支持这些功能。 <ul><li><code>build.rollupOptions.output.format: &#39;system&#39;</code> (<a href="https://github.com/rolldown/rolldown/issues/2387" target="_blank" rel="noreferrer">rolldown#2387</a>)</li><li><code>build.rollupOptions.output.format: &#39;amd&#39;</code> (<a href="https://github.com/rolldown/rolldown/issues/2528" target="_blank" rel="noreferrer">rolldown#2387</a>)</li><li><code>shouldTransformCachedModule</code> 钩子 (<a href="https://github.com/rolldown/rolldown/issues/4389" target="_blank" rel="noreferrer">rolldown#4389</a>)</li><li><code>resolveImportMeta</code> 钩子 (<a href="https://github.com/rolldown/rolldown/issues/1010" target="_blank" rel="noreferrer">rolldown#1010</a>)</li><li><code>renderDynamicImport</code> 钩子 (<a href="https://github.com/rolldown/rolldown/issues/4532" target="_blank" rel="noreferrer">rolldown#4532</a>)</li><li><code>resolveFileUrl</code> 钩子</li></ul></li><li><code>parseAst</code> / <code>parseAstAsync</code> 函数现在已被弃用，推荐使用功能更多的 <code>parseSync</code> / <code>parse</code> 函数。</li><li>（bug）<code>@vite-ignore</code> 注释的边界情况 (<a href="https://github.com/vitejs/rolldown-vite/issues/426" target="_blank" rel="noreferrer">rolldown-vite#426</a>)</li></ul><h2 id="migration-from-v6" tabindex="-1">从 v6 迁移 <a class="header-anchor" href="#migration-from-v6" aria-label="Permalink to “从 v6 迁移”">​</a></h2><p>请先查阅 Vite v7 文档中的 <a href="https://v7.vite.dev/guide/migration" target="_blank" rel="noreferrer">从 v6 迁移指南</a>（<a href="/guide/migration-from-v6">中文版</a>），了解如何将你的应用迁移到 Vite 7 所需的变更，然后再继续执行本页中的相关更改。</p>',6))])}const v=n(p,[["render",u]]);export{C as __pageData,v as default};
